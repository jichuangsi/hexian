<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 
	<script src="{ms:global.host/}/{ms:global.style/}/assets/js/reset.js"></script>
    <link rel="stylesheet" href="{ms:global.host/}/{ms:global.style/}/assets/style/reset.css"> 
	<link rel="stylesheet" href="{ms:global.host/}/{ms:global.style/}/assets/font_1340231_3b1rumcv30t/iconfont.css">
    <script src="{ms:global.host/}/{ms:global.style/}/libs/jquery.min.js"></script> 
	<script src="{ms:global.host/}/{ms:global.style/}/assets/js/antimoderate.js"></script>
	<script src="{ms:global.host/}/{ms:global.style/}/libs/jquery.fullpage.js"></script>
	-->
    <link rel="stylesheet" href="{ms:global.host/}/{ms:global.style/}/assets/style/index.css">
    <title>{ms:global.name/}</title>
    <style type="text/css">
    </style>
</head>

<body onscroll="scroll()">
   <#include "/m/head.html">
    <!-- <div id="fullpage"> -->
    <div class="wrapper">
        <!-- 最外层部分 -->
        <div class="banner">
            <!-- <div class="ite">
                Copyright 2019 Hexian All Rights Reserved 粤ICP备18009779号-1
            </div> -->
            <!-- 轮播部分 -->
            <ul class="imgList">
                <!-- 图片部分 -->
				{ms:arclist typeid=177  size=5 orderby=sort order=asc } 
					{ms:if item.flag=="h,"}
						<li class="imgOn">
					{/ms:if} 
					{ms:if item.flag!="h,"}
						<li>
					{/ms:if}
					<div class="title">
						 [field.descrip/]
					</div>
					<img src="{ms:global.host/}[field.litpic/]">
                </li>
                {/ms:arclist}
            </ul>
            <ul class="indexList">
                <!-- 图片右下角序号部分 -->
				{ms:arclist typeid=177 size=5 orderby=sort order=asc} 
					{ms:if item.index==1}
						<li class="indexOn">
					{/ms:if} 
					{ms:if item.index!=1}
						<li>
					{/ms:if} 
					</li>
				{/ms:arclist}
            </ul>
           
           
        </div>
    </div>
      <#include "/m/foot.html">
    <!-- </div> -->
    <script type="text/javascript">
        //     $('#fullpage').fullpage();
        // });
        // $(function(){
        //     var w = window.innerWidth
        //     var h = window.innerHeight
        //     var imgh = $('.imgOn').find('img')[0].height
        //     console.log(imgh)
        //     $('.imgList').css('height',imgh+'px')
            // $('.imgList>li').css('height',imgh+'px')
            // $('.imgList>li').find('img').css('width',w+'px')
            // $('.imgList>li').find('img').css('height',h+'px')
        // })
        // if(w>=1200){
        // }else{
        //     $('.imgList').css('height','635px')
        //     $('.imgList>li').css('height','635px')
        //     // $('.imgList>li').find('img').css('height','635px')
        // }
        // console.log($('.imgList>li>img'))
        var curIndex = 0; //当前index
        //   alert(imgLen);
        // 定时器自动变换2.5秒每次
        var autoChange;
        go()
        function go(){
            autoChange = setInterval(function () {
            if (curIndex < $(".imgList li").length - 1) {
                curIndex++;
            } else {
                curIndex = 0;
            }
            //调用变换处理函数
            changeTo(curIndex);
        }, 5500);
        }

        $(".indexList").find("li").each(function (item) {            
            $(this).click(function () {
                clearInterval(autoChange);
                changeTo(item);
                curIndex = item;
                go()
            });
        });
		
		$(".head").css({"position":"relative","z-index":"auto"});

        function changeTo(num) {
            $(".imgList").find("li").removeClass("imgOn")
            $(".indexList").find("li").removeClass("indexOn").eq(num).addClass("indexOn");
            $(".imgList").find("li").find('p').removeClass("qie")
            setTimeout(function(){
                $(".imgList").find("li").eq(num).addClass("imgOn");
            },100)
            for(let i = 0; i < $(".imgList").find("li").eq(num).find('p').length; i++){
               setTimeout(function() {
                $(".imgList").find("li").eq(num).find('p').eq(i).addClass("qie");
                }, i*4+'00');
            }
            // $(".imgList").find("li").removeClass("imgOn").hide().eq(num).fadeIn().addClass("imgOn");
            // $(".infoList").find("li").removeClass("infoOn").eq(num).addClass("infoOn");
            // $(".indexList").find("li").removeClass("indexOn").eq(num).addClass("indexOn");
        }
        // onresize = function(){
        //     h = window.innerHeight
        //     $('.imgList').css('height',h+'px')
        //     $('.imgList>li').css('height',h+'px')
        //     console.log(7777)
        //     console.log(h)
        // }iframefixed
        // var img = $('.ssas')[0]
        // AntiModerate.process(img, img.getAttribute("data-antimoderate-idata"))
        function iframefixed(){
            $('#head').css('position','fixed')
            $('#head').css('height','100%')
        }
        function iframeabsolute(){
            setTimeout(function(){
                $('#head').css('position','relative')
                $('#head').css('height','1.14rem')
            },500)
        }
        
		function indexJump(url){
			top.location.href = "{ms:global.url/}" + url;
		}
		
    // $(function(){
    //     function scroll(){
    //         var l = $(document).scrollLeft()
    //         var childWindow = $("#head")[0].contentWindow; //表示获取了嵌入在iframe中的子页面的window对象。  []将JQuery对象转成DOM对象，用DOM对象的contentWindow获取子页面window对象。
    //         childWindow.scroll_top(l);
    //     }
    // })
	var startX, startY, moveEndX, moveEndY, X, Y, endPos,isScrolling,time;
 
        $(".imgList").on("touchstart", function(e) {
            // e.preventDefault();
            startX = e.originalEvent.changedTouches[0].pageX,
            startY = e.originalEvent.changedTouches[0].pageY;
			time = +new Date
        });
        $(".imgList").on("touchmove", function(e) {
            // e.preventDefault();
            moveEndX = e.originalEvent.changedTouches[0].pageX,
            moveEndY = e.originalEvent.changedTouches[0].pageY,
            X = moveEndX - startX,
            Y = moveEndY - startY; 
            endPos = {x:X,y:Y,time:time};
            isScrolling = Math.abs(endPos.x) - Math.abs(endPos.y)<10 ? 1:0
            
            if(isScrolling == 1){
            }else{
                e.preventDefault();
            }
        }) 
        $(".imgList").on("touchend",function(e){
            // e.preventDefault();
            // $(".imgList")[0].removeEventListener('touchend',this,false);
            // $(".imgList")[0].removeEventListener('touchmove',this,false);
            EndX = e.originalEvent.changedTouches[0].pageX
            EndY = e.originalEvent.changedTouches[0].pageY
            console.log(Math.abs(endPos.x),Math.abs(endPos.y))
            if(isScrolling == 0 &&  +new Date - time > 100){
                if(EndX > startX) {
                if(curIndex == 0) {
                    clearInterval(autoChange);
                    changeTo(4);
                    curIndex = 4;
                    go()
                }else{
                    clearInterval(autoChange);
                    curIndex--;
                    changeTo(curIndex)
                    go()
                }
            }else{
                if(curIndex == 4) {
                    clearInterval(autoChange);
                    changeTo(0);
                    curIndex = 0;
                    go()
                }else{
                    clearInterval(autoChange);
                    curIndex++;
                    changeTo(curIndex)
                    go()
                }
            }
            }
            // else{
            //     $(".imgList")[0].removeEventListener('touchend',this,false);
            // }
        })
        
    </script>
</body>

</html>